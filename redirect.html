<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>æ­£åœ¨è·³è½‰...</title>

  <!-- âœ… Google Analytics GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXX'); // â† æ›æˆä½ çš„ GA ID
  </script>

  <script>
    // ğŸ”§ è¨­å®šä½ çš„è·³è½‰æ¸…å–®ï¼ˆå¯æ“´å……ï¼‰
    const redirectMap = {
      fb: "https://www.facebook.com/profile.php?id=61575181584170&locale=zh_TW",
      ms: "https://myship.7-11.com.tw/general/detail/GM2504166395415?fbclid=PAZXh0bgNhZW0CMTEAAad7U5ujrm9VnLXnSCbgxjp_1A6nQ0RYKIhEONJidQE6tgIMNo-G76d4vy5J7A_aem__6LN6fSPgH_R4veqTEAHMg",
      ig: "https://www.instagram.com/sotter_studio/"
    };

    function getQueryParam(key) {
      const params = new URLSearchParams(window.location.search);
      return params.get(key);
    }

    function buildRedirectUrl(baseUrl) {
      const utmParams = ['utm_source', 'utm_medium', 'utm_campaign'];
      const url = new URL(baseUrl);
      utmParams.forEach(param => {
        const value = getQueryParam(param);
        if (value) {
          url.searchParams.set(param, value);
        }
      });
      return url.toString();
    }

    function trackAndRedirect(goto, targetUrl) {
      let isRedirected = false;

      // â±ï¸ æœ€å¤šç­‰ 500msï¼Œå°±ç®—æ²’ callback ä¹Ÿè·³è½‰
      const timeout = setTimeout(() => {
        if (!isRedirected) {
          isRedirected = true;
          window.location.href = targetUrl;
        }
      }, 500);

      // âœ… ç™¼é€ GA4 äº‹ä»¶ï¼ˆéåŒæ­¥ï¼‰ï¼ŒæˆåŠŸå†è·³
      gtag('event', 'link_click', {
        event_category: 'redirect',
        event_label: goto,
        event_callback: () => {
          if (!isRedirected) {
            clearTimeout(timeout);
            isRedirected = true;
            window.location.href = targetUrl;
          }
        }
      });
    }

    window.onload = () => {
      const goto = getQueryParam('goto');
      const baseUrl = redirectMap[goto];

      if (!goto || !baseUrl) {
        document.body.innerHTML = "<h3>éŒ¯èª¤ï¼šæœªçŸ¥çš„è·³è½‰ä»£ç¢¼</h3>";
        return;
      }

      const fullUrl = buildRedirectUrl(baseUrl);
      trackAndRedirect(goto, fullUrl);
    };
  </script>
</head>
<body>
  <!-- ä½¿ç”¨è€…æ‡‰è©²å¹¾ä¹çœ‹ä¸åˆ°é€™æ®µï¼ˆä¸åˆ°åŠç§’å°±è·³è½‰ï¼‰ -->
  <p style="text-align:center;">æ­£åœ¨ç‚ºæ‚¨è·³è½‰ï¼Œè«‹ç¨å€™...</p>
</body>
</html>
